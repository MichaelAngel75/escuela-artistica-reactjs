create aws lambda in python following these instruction and the python program working as a non-lambda version: 
This is related to a AWS Lambda function on python which will be on private Subnet on VPC and will be triggered by a SQS message At the moment of initializing: 

1) <AWS lambda Env var: MY-API-KEY> will contain the api key to be used to call API calls to obtain information about firmas, empty pdf templates, position of elements within PDF (student name, profesor, firma png/jpeg/etc, curso)

2) Obtain all valid signatures and stored in memory to be obtain "url" by mapping a value either by signatures.name, signatures.professorName, to a url for gif, jpeg, etc coming from the last column from the csv file curl -H 'api-key-pohualizcalli: <AWS lambda Env var: MY-API-KEY>' https://admin.my-website.com/internal/signatures Response example: { "signatures": [ { "id": 2, "name": "oscar pimentel", "url": "https://resources.my-website.com/generacion-diplomas/signatures/2025-12-21/oscar_pimentel.gif", "professorName": "Oscar Pimentel", "createdBy": "emailusuario@gmail.com", "createdAt": "2025-12-21T22:52:22.476Z", "updatedAt": "2025-12-21T22:52:22.476Z" }, { "id": 1, "name": "mauricio sanchez", "url": "https://resources.my-website.com/generacion-diplomas/signatures/2025-12-21/mauricio_sanchez.gif", "professorName": "Mauricio Sanchez", "createdBy": "emailusuario@gmail.com", "createdAt": "2025-12-21T22:51:18.358Z", "updatedAt": "2025-12-21T22:51:18.358Z" } ] } 
And stores in a map to obtain the url to obtain the signature whenever cycling input CSV file

3) Obtain the only active diploma template with student name, curso, signature/name of professor, date empties spaces This will obtain one single pdf template and be used to be filled for each student line from CSV file. curl -H 'api-key-pohualizcalli: <AWS lambda Env var: MY-API-KEY>' https://admin.my-website.com/internal/templates/active { "template": { "id": 1, "name": "template-2024", "url": "https://resources.my-website.com/generacion-diplomas/empty-templates/2025-12-21/17-40-42/constancia_vacio.pdf", "status": "Active", "createdBy": "emailusuario@gmail.com", "createdAt": "2025-12-21T22:40:10.528Z", "updatedAt": "2025-12-21T22:40:45.836Z" } } 
And stored on local variable to be used and avoid calling each time for each line on input csv file and download once to temp/  folder within aws Lambda


4) Obtain the positions where the fields: curl -H 'api-key-pohualizcalli: <AWS lambda Env var: MY-API-KEY>' https://admin.my-website.com/internal/configuration "estudiante" (position x, y or "y" if x will be centered-wise, font, color, size), "curso" (position x, y or "y" if x will be centered-wise, font, color, size), "profesor-signature" (position x,y, and size where the image: gif, jpeg, will be placed within pdf active template) "profesor" (position x, y or "y" if x will be centered-wise, font, color, size), "fecha" (position x, y or "y" if x will be centered-wise, font, color, size), { "id": 1, "fieldMappings": { "curso": { "y": 253, "font": { "name": "Helvetica-Bold", "size": 12, "color": "#374151" }, "centered": true }, "fecha": { "x": 418, "y": 25, "font": { "name": "Helvetica", "size": 12, "color": "#000000" } }, "profesor": { "y": 97, "font": { "name": "Helvetica", "size": 12, "color": "#000000" }, "x_range": [ 433, 573 ] }, "estudiante": { "y": 300, "font": { "name": "Helvetica-Bold", "size": 24, "color": "#6D28D9" }, "centered": true }, "profesor-signature": { "x": 442, "y": 100, "size": 125 } }, "updatedBy": "mabelsrescue@gmail.com", "createdAt": "2025-12-21T17:38:45.334Z", "updatedAt": "2025-12-22T04:30:58.639Z" } Note: Up to this previous point all executions should be done only one time and keep it in memory for later use for each line on input CSV file.

5) this aws lambda will receive a sqs message similar to this: { "created_by": "mabelsrescue@gmail.com", "file_name": "diploma-datos-afp.csv", "csv_url": "https://resources.my-website.com/generacion-diplomas/generated-diplomas/2025-12-26/proceso-2/diploma-datos-afp.csv", "batch_id": 2 } 

6) it will go to this location and read a CSV file which is in this form: ( number of lines vary ) it will read line by line and create a diploma with the information, extracted Note: First line should be skipped since are headers 
6.1) First columns correspond to the Student full name "nombre" 
6.2) Second column corresponds to the name of the trainined/course: "curso" 
6.3) third colums corresponds to a date: "fecha" 
6.4) fourth columns correspond to a profesor name: "profesor" find below the real example of how the information from real CSV file will come. 

nombre,curso,fecha,profesor 
Juan Pérez,Curso de Python, 2024-1-29,Oscar Pimentel 
Ana Gómez,Taller de Matemáticas, 01/03/2024,Oscar Pimentel 
Carlos López,Taller de Machine Learning,Marzo de 2025,oscar_pimentel.gif

Note: signatures will be mapped either by the name of the profesor or if the url of the image contains the name of the signature file (.gif, jpeg, etc)

7) for each line it will be filled using the configuration fields to determine x,y position, font, color, and size then a pdf filled will be name using student name all lower case and spaces replaced by "_" underscore then name of the course same replaces then "_" + UUID +".pdf" and save it on the same aws lambda /tmp/<proceso-2> process-2 will be taken from the url where the csv input file resides i.e "csv_url": "https://resources.my-website.com/generacion-diplomas/generated-diplomas/2025-12-26/proceso-2/diploma-datos-afp.csv", as it goes reading line by line then it will create a new csv name as the input file plus "-resultado.csv" Containing at the end an additional colunm saying: "exitosamente creado" or "<any error description found" Once the process comes to the end of reading all files all content from /tmp/<proceso-2> should be zipped and send it to <generated-url-for-zip>: variables for this url should be <process-number> as per the input csv file <original-csv-file> which it will be append a zip extension. "https://resources.my-website.com/generacion-diplomas/generated-diplomas/2025-12-26/<process-number>/diploma-generated/<original-csv-file>.zip this latest url should be updated on database by calling an api as per below: Batch id should be taken from step 5) "batch_id": 2 curl -X PATCH 'https://resources.my-website.com/internal/diploma-batches/<batch_id>' \ -H 'Content-Type: application/json' \ -H 'api-key-pohualizcalli: <AWS lambda Env var: MY-API-KEY>' \ -d '{ "status": "completado", ==> "error" if some error interrupted the process and didn't reach the end "totalRecords": <count of csv line> "zipUrl": <generated-url-for-zip> }' finished use the following program which is working generating this diplomas as batch local process on local computer whih is workable version for now.


